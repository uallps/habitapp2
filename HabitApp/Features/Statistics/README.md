# Statistics Feature

This feature is implemented as a plugin (see `HabitStatisticsPlugin`) and relies on `StatisticsDependencies` for data access. The core app provides adapters in `Infraestructure/Statistics` that expose habits and completions through the `HabitStatsDataSource` and `CompletionStatsDataSource` protocols.

## Data Flow
- `StatsOverviewViewModel` loads habits + completions, then builds recaps for daily/weekly/monthly/yearly.
- `StatsCalculator` is the domain engine. It builds totals, day stats, per-habit stats, and streaks based on scheduled days.
- Highlights are generated by `StatsHighlightBuilder` with special handling for current periods.

## Streak Rules
- Global streak = consecutive days where all expected habits were completed.
- Habit streak = consecutive scheduled days completed for that habit (non-scheduled days do not break).
- Annual top streaks list the best 3 streaks by duration in days, including active streaks that cross years.

## UI Composition
- `StatsOverviewScreen` shows the reference date, recaps, and a quick monthly calendar.
- `RecapDetailScreen` renders the main visual (daily detail, weekly bars, monthly calendar, yearly bars) plus breakdowns.
- `StatsHabitFilterView` lets the user filter calendars by habit (archived habits are labeled in the picker).

## Calendar and Periods
All date logic uses the injected calendar (configured in `AppConfig`) with Monday as the first weekday. Period intervals come from `StatsPeriod` to keep weekly and monthly boundaries consistent across the feature.
